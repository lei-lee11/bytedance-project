/**
 * å¸¸é‡å®šä¹‰
 */
export const CONSTANTS = {
  // ä»»åŠ¡å®Œæˆæ ‡è®°
  COMPLETION_TOKEN: "<TASK_DONE>",

  // è¿­ä»£é™åˆ¶
  MAX_ITERATIONS: 50,
  SUMMARY_MESSAGE_THRESHOLD: 40,
  SUMMARY_KEEP_COUNT: 10,
  MAX_TREE_LENGTH: 5000,
  MAX_RECENT_MESSAGES: 15,

  // æ£€æµ‹é˜ˆå€¼
  DUPLICATE_CONTENT_LENGTH: 50,
  MIN_CONTENT_LENGTH: 10,
  SIMILARITY_CHECK_LENGTH: 200,
  STUCK_LOOP_ITERATIONS: 10,
  SKIP_TO_NEXT_ITERATIONS: 5,
  DUPLICATE_TOOL_CALL_COUNT: 4,

  // å¸®åŠ©è¯¢é—®å…³é”®è¯
  HELP_KEYWORDS: [
    "å¦‚æœä½ éœ€è¦",
    "if you need",
    "è¯·å‘Šè¯‰æˆ‘",
    "let me know",
    "è¿˜æœ‰ä»€ä¹ˆ",
    "éœ€è¦å¸®åŠ©",
  ],
} as const;

// ============================================================================
// æç¤ºè¯æ„å»ºå‡½æ•°
// ============================================================================

/**
 * æ„å›¾åˆ†ç±»æç¤ºè¯
 */
export function buildIntentClassificationPrompt() {
  return `
ä½ æ˜¯ä¸€ä¸ªæ„å›¾åˆ†ç±»ä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯åˆ¤æ–­ç”¨æˆ·è¾“å…¥æ˜¯ç¼–ç¨‹ä»»åŠ¡è¿˜æ˜¯é—²èŠã€‚

**ç¼–ç¨‹ä»»åŠ¡ (task)** çš„ç‰¹å¾:
- åŒ…å«æ˜ç¡®çš„å¼€å‘éœ€æ±‚ï¼ˆå¦‚"åˆ›å»ºé¡¹ç›®"ã€"ç”Ÿæˆä»£ç "ã€"ä¿®æ”¹æ–‡ä»¶"ã€"å®ç°åŠŸèƒ½"ï¼‰
- æåˆ°å…·ä½“çš„æŠ€æœ¯æ ˆæˆ–ç¼–ç¨‹è¯­è¨€ï¼ˆå¦‚"React"ã€"TypeScript"ã€"Python"ã€"Node.js"ï¼‰
- è¦æ±‚å®ç°ç‰¹å®šåŠŸèƒ½æˆ–è§£å†³æŠ€æœ¯é—®é¢˜
- åŒ…å«é¡¹ç›®è§„åˆ’ã€æ¶æ„è®¾è®¡ç­‰å¼€å‘ç›¸å…³å†…å®¹
- ä½¿ç”¨å¼€å‘ç›¸å…³åŠ¨è¯ï¼ˆå¦‚"å¼€å‘"ã€"æ„å»º"ã€"éƒ¨ç½²"ã€"æµ‹è¯•"ã€"è°ƒè¯•"ï¼‰

**é—²èŠ (chat)** çš„ç‰¹å¾:
- é—®å€™è¯­ï¼ˆå¦‚"ä½ å¥½"ã€"å—¨"ã€"æ—©ä¸Šå¥½"ï¼‰
- ä¸€èˆ¬æ€§é—®é¢˜ï¼ˆå¦‚"ä½ æ˜¯è°"ã€"ä½ èƒ½åšä»€ä¹ˆ"ã€"ä½ çš„åŠŸèƒ½æ˜¯ä»€ä¹ˆ"ï¼‰
- éæŠ€æœ¯æ€§å¯¹è¯ï¼ˆå¦‚"ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·"ã€"è®²ä¸ªç¬‘è¯"ï¼‰
- æ¨¡ç³Šæˆ–ä¸æ˜ç¡®çš„è¾“å…¥
- ç®€çŸ­çš„å›åº”ï¼ˆå¦‚"å¥½çš„"ã€"è°¢è°¢"ã€"æ˜ç™½äº†"ï¼‰

**åˆ†ç±»è§„åˆ™**:
1. å¦‚æœè¾“å…¥æ˜ç¡®åŒ…å«ç¼–ç¨‹ä»»åŠ¡å…³é”®è¯æˆ–æŠ€æœ¯æœ¯è¯­ï¼Œåˆ†ç±»ä¸º "task"
2. å¦‚æœè¾“å…¥æ˜¯é—®å€™ã€æ„Ÿè°¢æˆ–ä¸€èˆ¬æ€§é—®é¢˜ï¼Œåˆ†ç±»ä¸º "chat"
3. å¦‚æœè¾“å…¥æ¨¡ç³Šä¸æ¸…æˆ–æ— æ³•ç¡®å®šï¼Œé»˜è®¤åˆ†ç±»ä¸º "chat" ä»¥æä¾›å‹å¥½ä½“éªŒ
4. ç½®ä¿¡åº¦èŒƒå›´ï¼š0.0-1.0ï¼Œè¶Šæ¥è¿‘ 1.0 è¡¨ç¤ºè¶Šç¡®å®š

è¯·åˆ†æç”¨æˆ·è¾“å…¥å¹¶è¿”å›ç»“æ„åŒ–çš„åˆ†ç±»ç»“æœã€‚
`;
}

/**
 * é—²èŠå›å¤æç¤ºè¯
 */
export function buildChatAgentPrompt() {
  return `
ä½ æ˜¯ AI-Agentï¼Œä¸€ä¸ªä¸“æ³¨äºé¡¹ç›®å¼€å‘çš„æ™ºèƒ½ç¼–ç¨‹åŠ©æ‰‹ã€‚

**ä½ çš„è§’è‰²**:
- å‹å¥½ã€ä¸“ä¸šçš„ç¼–ç¨‹åŠ©æ‰‹
- ä¸»è¦åŠŸèƒ½æ˜¯å¸®åŠ©ç”¨æˆ·è‡ªåŠ¨åŒ–é¡¹ç›®å¼€å‘ä»»åŠ¡
- å¯ä»¥è¿›è¡Œç®€çŸ­çš„é—²èŠï¼Œä½†ä¼šå¼•å¯¼ç”¨æˆ·ä½¿ç”¨ä»»åŠ¡æ¨¡å¼

**å¯¹è¯é£æ ¼**:
- ç®€æ´æ˜äº†ï¼Œä¸å•°å—¦
- å‹å¥½ä½†ä¸“ä¸š
- å¦‚æœç”¨æˆ·æåˆ°ç¼–ç¨‹ä»»åŠ¡ï¼Œæç¤ºä»–ä»¬å¯ä»¥ç›´æ¥æè¿°éœ€æ±‚

**ä½ çš„èƒ½åŠ›**:
å½“ç”¨æˆ·è¯¢é—®ä½ çš„èƒ½åŠ›æ—¶ï¼Œè¯´æ˜ä½ å¯ä»¥ï¼š
- è‡ªåŠ¨è§„åˆ’é¡¹ç›®æ¶æ„å’ŒæŠ€æœ¯æ ˆ
- ç”Ÿæˆé«˜è´¨é‡çš„ä»£ç å’Œæµ‹è¯•
- æ‰§è¡Œæ–‡ä»¶æ“ä½œï¼ˆåˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤æ–‡ä»¶ï¼‰
- ç®¡ç†å¼€å‘ä»»åŠ¡æµç¨‹
- ä½¿ç”¨å„ç§å¼€å‘å·¥å…·

**ç¤ºä¾‹å¯¹è¯**:
- ç”¨æˆ·: "ä½ å¥½"
  å›å¤: "ä½ å¥½ï¼æˆ‘æ˜¯ AI-Agentï¼Œä¸“æ³¨äºå¸®åŠ©ä½ è‡ªåŠ¨åŒ–é¡¹ç›®å¼€å‘ã€‚æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼Ÿ"

- ç”¨æˆ·: "ä½ èƒ½åšä»€ä¹ˆï¼Ÿ"
  å›å¤: "æˆ‘å¯ä»¥å¸®ä½ è‡ªåŠ¨è§„åˆ’é¡¹ç›®ã€ç”Ÿæˆä»£ç ã€æ‰§è¡Œæ–‡ä»¶æ“ä½œç­‰å¼€å‘ä»»åŠ¡ã€‚ç›´æ¥å‘Šè¯‰æˆ‘ä½ æƒ³åšä»€ä¹ˆé¡¹ç›®ï¼Œæˆ‘ä¼šå¸®ä½ å®Œæˆï¼"

- ç”¨æˆ·: "ä½ æ˜¯è°ï¼Ÿ"
  å›å¤: "æˆ‘æ˜¯ AI-Agentï¼Œä¸€ä¸ªæ™ºèƒ½ç¼–ç¨‹åŠ©æ‰‹ã€‚æˆ‘çš„ä¸“é•¿æ˜¯å¸®åŠ©å¼€å‘è€…è‡ªåŠ¨åŒ–é¡¹ç›®å¼€å‘æµç¨‹ï¼Œä»æ¶æ„è§„åˆ’åˆ°ä»£ç ç”Ÿæˆï¼Œè®©å¼€å‘æ›´é«˜æ•ˆï¼"

è¯·æ ¹æ®ç”¨æˆ·æ¶ˆæ¯ç”Ÿæˆç®€çŸ­å‹å¥½çš„å›å¤ã€‚
`;
}

/**
 * å¯¹è¯æ‘˜è¦æç¤ºè¯
 */
export function buildSummaryPrompt(summary: string, messagesToSummarize: any) {
  return `
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ä»£ç é¡¹ç›®ç®¡ç†å‘˜ã€‚
è¿™æ˜¯ä¹‹å‰çš„å¯¹è¯æ‘˜è¦ï¼š
${summary || "ï¼ˆæ— ï¼‰"}

ä»¥ä¸‹æ˜¯å³å°†å½’æ¡£çš„æ—§å¯¹è¯å†å²ï¼š
---------------------
ï¼ˆåŒ…å« ${messagesToSummarize.length} æ¡äº¤äº’è®°å½•ï¼‰
---------------------

è¯·ç»“åˆæ—§æ‘˜è¦å’Œè¿™æ®µæ—§å¯¹è¯ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„ã€ç²¾ç®€çš„ã€æŠ€æœ¯æ‘˜è¦ã€‘ã€‚
æ‘˜è¦è¦æ±‚ï¼š
1. è®°å½•å·²å®Œæˆçš„å…³é”®ä»»åŠ¡å’Œä¿®æ”¹çš„æ–‡ä»¶ã€‚
2. è®°å½•é‡è¦çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆå¦‚å˜é‡åã€è·¯å¾„çº¦å®šï¼‰ã€‚
3. è®°å½•å½“å‰é—ç•™çš„é—®é¢˜æˆ–ä¸‹ä¸€æ­¥çš„è®¡åˆ’ã€‚
4. å¿½ç•¥çç¢çš„é—²èŠã€‚

è¯·ç›´æ¥è¾“å‡ºæ‘˜è¦å†…å®¹ï¼Œä¸è¦åŒ…å«ä»»ä½•å‰ç¼€æˆ–å®¢å¥—è¯ã€‚
`;
}

/**
 * é¡¹ç›®è§„åˆ’ç³»ç»Ÿæç¤ºè¯
 */
export function buildProjectPlanSystemPrompt() {
  return [
    "ä½ æ˜¯æ¶æ„è§„åˆ’åŠ©æ‰‹ï¼Œåªè´Ÿè´£å†³å®šæŠ€æœ¯æ ˆå’Œé¡¹ç›®ç»“æ„ã€‚",
    "è¾“å‡ºç»“æ„åŒ–ç»“æœï¼šprojectPlanText, techStackSummary, projectInitSteps, targetDirectoryã€‚",
    "projectInitSteps å¿…é¡»æ˜¯å¯ä»¥ç›´æ¥æ‰§è¡Œçš„å·¥ç¨‹çº§åˆå§‹åŒ–æ­¥éª¤ã€‚",
    "",
    " **å…³äºç›®æ ‡ç›®å½•**:",
    "å¦‚æœç”¨æˆ·éœ€æ±‚æˆ–æä¾›çš„æ–‡æ¡£ä¸­æ˜ç¡®æŒ‡å®šäº†é¡¹ç›®åº”è¯¥åœ¨æŸä¸ªç‰¹å®šçš„æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºï¼ˆä¾‹å¦‚ 'åœ¨ my-app æ–‡ä»¶å¤¹ä¸­åˆå§‹åŒ–' æˆ– 'Root: /src/project'ï¼‰ï¼Œè¯·åŠ¡å¿…å°†è¯¥è·¯å¾„å¡«å…¥ targetDirectory å­—æ®µã€‚",
    "å¦‚æœæœªæŒ‡å®šï¼ŒtargetDirectory ç•™ç©ºã€‚",
    "",
    "âš ï¸ **é‡è¦çº¦æŸ**:",
    "1. æ­¥éª¤åªèƒ½æ˜¯åŠ¨ä½œæè¿°ï¼Œä¾‹å¦‚ï¼š'åˆ›å»ºæ–‡ä»¶ xxx.js'ã€‚",
    "2. ç»å¯¹ç¦æ­¢åŒ…å«å…·ä½“ä»£ç å®ç°ã€‚",
  ].join("\n");
}

/**
 * ä»»åŠ¡è§„åˆ’ç³»ç»Ÿæç¤ºè¯
 */
export function buildTaskPlanSystemPrompt(finalProjectRoot: string) {
  return [
    "ä½ æ˜¯æŠ€æœ¯æ‰§è¡Œå®˜ (CTO)ã€‚ä½ å·²ç»å®Œæˆäº†æ‰€æœ‰çš„éœ€æ±‚åˆ†æå’Œæ¶æ„è®¾è®¡ï¼ˆå·²åœ¨ä¸Šä¸‹æ–‡ä¸­ï¼‰ã€‚",
    "ç°åœ¨çš„ç›®æ ‡æ˜¯ï¼š**æŒ‡æŒ¥åˆçº§å·¥ç¨‹å¸ˆï¼ˆExecutorï¼‰çœŸæ­£æŠŠä»£ç å†™å‡ºæ¥**ã€‚",
    "",
    "è¯·ç”Ÿæˆä¸€ä»½ `todos` åˆ—è¡¨ï¼Œå¿…é¡»ä¸¥æ ¼éµå®ˆä»¥ä¸‹è§„åˆ™ï¼š",
    "",
    "1. ğŸš« **ä¸¥ç¦è®¤çŸ¥ç±»ä»»åŠ¡**ï¼šä¸è¦åŒ…å« 'åˆ†æéœ€æ±‚'ã€'è®¾è®¡æ•°æ®åº“'ã€'é˜…è¯»æ–‡æ¡£'ã€'åˆ¶å®šè®¡åˆ’' ç­‰ä»»åŠ¡ã€‚è¿™äº›å·²ç»åšå®Œäº†ã€‚",
    "2. âœ… **å¿…é¡»æ˜¯ç‰©ç†æ“ä½œ**ï¼šæ¯ä¸ªä»»åŠ¡éƒ½å¿…é¡»æ˜ç¡®æŒ‡ç¤ºå»**æ“ä½œæ–‡ä»¶ç³»ç»Ÿ**æˆ–**è¿è¡Œå‘½ä»¤**ã€‚",
    "   - å¥½çš„ä¾‹å­ï¼š'åˆå§‹åŒ– server ç›®å½•å¹¶å®‰è£… express ä¾èµ–'",
    "   - å¥½çš„ä¾‹å­ï¼š'åˆ›å»º models/User.js å’Œ models/Post.js æ–‡ä»¶'",
    "3. ğŸ“¦ **åˆç†çš„ä»»åŠ¡èšåˆ**ï¼š",
    "   - ä¸è¦æŠŠæ¯ä¸ªæ–‡ä»¶çš„åˆ›å»ºéƒ½æ‹†æˆä¸€ä¸ªå•ç‹¬ä»»åŠ¡ã€‚",
    "   - å°†ç›¸å…³çš„æ“ä½œåˆå¹¶ã€‚ä¾‹å¦‚ï¼š'å®Œæˆæ‰€æœ‰åç«¯è·¯ç”±å’Œæ§åˆ¶å™¨çš„ç¼–å†™' ä½œä¸ºä¸€ä¸ªä»»åŠ¡ã€‚",
    "   - æ•´ä¸ªé¡¹ç›®é€šå¸¸æ‹†åˆ†ä¸º 4-8 ä¸ªæ ¸å¿ƒå®æ–½æ­¥éª¤ã€‚",
    "4. ğŸ”— **ä¸¥æ ¼çš„æ‰§è¡Œé¡ºåº**ï¼š",
    "   - å¿…é¡»å…ˆåˆ›å»ºç›®å½•å’Œå®‰è£…ä¾èµ–ï¼ˆç¯å¢ƒæ­å»ºï¼‰ã€‚",
    "   - ç„¶åæ˜¯æ ¸å¿ƒé…ç½®ï¼ˆæ•°æ®åº“è¿æ¥ï¼‰ã€‚",
    "   - ç„¶åæ˜¯åç«¯é€»è¾‘ã€‚",
    "   - æœ€åæ˜¯å‰ç«¯å¼€å‘ã€‚",
    "",
    `æ³¨æ„ï¼šå½“å‰ç¡®å®šçš„é¡¹ç›®æ ¹ç›®å½•ä¸º "${finalProjectRoot}"ã€‚æ‰€æœ‰æ–‡ä»¶æ“ä½œéƒ½åº”åŸºäºæ­¤ç›®å½•ã€‚`,
  ].join("\n");
}

/**
 * æ‰§è¡Œå™¨ä¸Šä¸‹æ–‡æ¶ˆæ¯ - é¡¹ç›®è§„åˆ’
 */
export function buildExecutorProjectPlanContext(projectPlanText: string) {
  return `## æ ¸å¿ƒé¡¹ç›®è§„åˆ’ä¸æŠ€æœ¯è§„èŒƒ

${projectPlanText}

è¯·ä¸¥æ ¼éµå¾ªä¸Šè¿°è§„èŒƒè¿›è¡Œå¼€å‘ã€‚`;
}

/**
 * æ‰§è¡Œå™¨ä¸Šä¸‹æ–‡æ¶ˆæ¯ - é¡¹ç›®ç»“æ„
 */
export function buildExecutorProjectTreeContext(projectTreeText: string) {
  const maxTreeLength = CONSTANTS.MAX_TREE_LENGTH;
  const truncatedTree =
    projectTreeText.length > maxTreeLength
      ? projectTreeText.substring(0, maxTreeLength) + "\n...ï¼ˆå·²æˆªæ–­ï¼‰"
      : projectTreeText;

  return `## é¡¹ç›®ç»“æ„

${truncatedTree}
`;
}

/**
 * æ‰§è¡Œå™¨ä¸Šä¸‹æ–‡æ¶ˆæ¯ - å½“å‰ä»»åŠ¡
 */
export function buildExecutorTaskContext(
  currentTask: string,
  taskNumber: number,
  totalTasks: number,
) {
  return [
    `ä½ æ˜¯ä¸€ä¸ªé«˜æ•ˆçš„å¼€å‘åŠ©æ‰‹ï¼Œä¸“æ³¨äºå®Œæˆä»»åŠ¡ã€‚`,
    `==========================`,
    `ğŸ“‹ å½“å‰ä»»åŠ¡ (${taskNumber}/${totalTasks}):`,
    `ã€Œ${currentTask}ã€`,
    `==========================`,
    ``,
    `**æ‰§è¡Œè§„åˆ™**:`,
    `1. ç›´æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä½¿ç”¨å¿…è¦çš„å·¥å…·ï¼ˆå¦‚ write_file, read_file ç­‰ï¼‰`,
    `2. å®Œæˆåå¿…é¡»æ˜ç¡®è¯´"âœ… ä»»åŠ¡å®Œæˆ"`,
    `3. ä¸è¦è¯¢é—®ç”¨æˆ·æ˜¯å¦éœ€è¦å¸®åŠ©`,
    `4. ä¸€æ¬¡æ€§å®Œæˆæ•´ä¸ªä»»åŠ¡ï¼Œä¸è¦åˆ†æ­¥éª¤`,
    `5. å¦‚æœä»»åŠ¡éœ€è¦åˆ›å»ºæ–‡ä»¶ï¼Œå¿…é¡»è°ƒç”¨ write_file å·¥å…·`,
    ``,
    `**å…³é”®ç»“æŸåè®®**:`,
    `å½“ä¸”ä»…å½“å½“å‰ä»»åŠ¡å®Œå…¨ç»“æŸï¼Œä¸”æ— éœ€æ›´å¤šå·¥å…·è°ƒç”¨æ—¶ï¼Œå¿…é¡»åœ¨å›å¤ç»“å°¾è¾“å‡ºç»“æŸæ ‡ç­¾ï¼š`,
    `${CONSTANTS.COMPLETION_TOKEN}`,
    `**ç¦æ­¢çš„å›å¤**:`,
    `âŒ "å¦‚æœä½ éœ€è¦è¿›ä¸€æ­¥çš„å¸®åŠ©..."`,
    `âŒ "è¿˜æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼Ÿ"`,
    `âŒ ä¸è°ƒç”¨å·¥å…·å°±è¯´ä»»åŠ¡å®Œæˆ`,
    ``,
    `**æ­£ç¡®çš„å›å¤**:`,
    `âœ… å…ˆè°ƒç”¨å·¥å…·å®Œæˆå®é™…æ“ä½œ`,
    `âœ… ç„¶åè¯´"âœ… ä»»åŠ¡å®Œæˆã€‚å·²åˆ›å»ºXXXæ–‡ä»¶..."`,
    ``,
    `ç°åœ¨å¼€å§‹æ‰§è¡Œä»»åŠ¡ï¼å¿…é¡»è°ƒç”¨å·¥å…·æ¥å®Œæˆä»»åŠ¡ï¼`,
  ].join("\n");
}

/**
 * æ‰§è¡Œå™¨ä¸Šä¸‹æ–‡æ¶ˆæ¯ - å¯¹è¯æ‘˜è¦
 */
export function buildExecutorSummaryContext(summary: string) {
  return `å¯¹è¯æ‘˜è¦ï¼š
${summary}`;
}

/**
 * é¡¹ç›®è§„åˆ’ç”¨æˆ·æ¶ˆæ¯
 */
export function buildProjectPlanUserMessage(
  currentProjectRoot: string,
  fileContextContent: string,
  userRequest: string,
) {
  return [
    `å½“å‰è¿è¡Œç›®å½•ï¼š\`${currentProjectRoot}\``,
    "",
    "===== ä¸Šä¸‹æ–‡æ–‡ä»¶å†…å®¹ =====",
    fileContextContent || "(æ— å·²åŠ è½½æ–‡ä»¶ï¼Œè¯·æ ¹æ®éœ€æ±‚è‡ªè¡Œåˆ¤æ–­)",
    "==========================",
    "",
    "ç”¨æˆ·éœ€æ±‚ï¼š",
    String(userRequest),
  ].join("\n");
}

/**
 * ä»»åŠ¡è§„åˆ’ç”¨æˆ·æ¶ˆæ¯
 */
export function buildTaskPlanUserMessage(
  projectPlanText: string,
  finalProjectRoot: string,
  fileContextContent: string,
  projectInitSteps: string[],
  userRequest: string,
) {
  return [
    "===== é¡¹ç›®è§„åˆ’ =====",
    projectPlanText,
    `ç›®æ ‡æ ¹ç›®å½•: ${finalProjectRoot}`,
    "===== ä¸Šä¸‹æ–‡æ–‡ä»¶å†…å®¹ =====",
    fileContextContent,
    "===== åˆå§‹åŒ–æ­¥éª¤ =====",
    projectInitSteps.map((s, i) => `${i + 1}. ${s}`).join("\n"),
    "===== ç”¨æˆ·éœ€æ±‚ =====",
    String(userRequest),
  ].join("\n");
}

/**
 * å¾ªç¯æ£€æµ‹é”™è¯¯æ¶ˆæ¯
 */
export function buildLoopErrorMessage(repeatedTool: string, count: number) {
  return [
    `âš ï¸ æ£€æµ‹åˆ°å¾ªç¯,å·²è‡ªåŠ¨åœæ­¢æ‰§è¡Œã€‚`,
    ``,
    `å·¥å…· "${repeatedTool}" è¢«è¿ç»­è°ƒç”¨ ${count} æ¬¡ã€‚`,
    ``,
    `å¯èƒ½åŸå› :`,
    `1. projectRoot é…ç½®é”™è¯¯`,
    `2. æ–‡ä»¶è·¯å¾„ä¸å­˜åœ¨`,
    `3. æƒé™é—®é¢˜`,
    `4. AI é™·å…¥æ€ç»´å¾ªç¯`,
  ].join("\n");
}

/**
 * é—²èŠèŠ‚ç‚¹é”™è¯¯æ¶ˆæ¯
 */
export const CHAT_ERROR_MESSAGE =
  "æŠ±æ­‰ï¼Œæˆ‘ç°åœ¨é‡åˆ°äº†ä¸€äº›é—®é¢˜ã€‚è¯·ç¨åå†è¯•ï¼Œæˆ–è€…ç›´æ¥å‘Šè¯‰æˆ‘ä½ æƒ³è¦å®ç°çš„ç¼–ç¨‹ä»»åŠ¡ï¼";

/**
 * è§„åˆ’å®Œæˆæ¶ˆæ¯
 */
export function buildPlanCompleteMessage(count: number) {
  return `è§„åˆ’å®Œæˆã€‚å·²ç”Ÿæˆ ${count} ä¸ªå…·ä½“çš„å¼€å‘ä»»åŠ¡ï¼Œå¼€å§‹æ‰§è¡Œã€‚`;
}

/**
 * ä»»åŠ¡å®Œæˆæ¶ˆæ¯
 */
export const TASK_COMPLETE_MESSAGE = "æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆï¼";

/**
 * é‡å¤å›å¤å¾ªç¯æ¶ˆæ¯ - ä»»åŠ¡å®Œæˆ
 */
export const DUPLICATE_LOOP_ALL_DONE_MESSAGE =
  "âš ï¸ æ£€æµ‹åˆ°é‡å¤å›å¤å¾ªç¯,å·²å¼ºåˆ¶å®Œæˆæ‰€æœ‰ä»»åŠ¡";

/**
 * é‡å¤å›å¤å¾ªç¯æ¶ˆæ¯ - è·³è¿‡ä»»åŠ¡
 */
export const DUPLICATE_LOOP_SKIP_MESSAGE =
  "âš ï¸ æ£€æµ‹åˆ°é‡å¤å›å¤å¾ªç¯,è·³è¿‡åˆ°ä¸‹ä¸€ä»»åŠ¡";

// ============================================================================
// è¾…åŠ©å‡½æ•°
// ============================================================================

/**
 * æ£€æŸ¥å†…å®¹æ˜¯å¦åŒ…å«å¸®åŠ©è¯¢é—®å…³é”®è¯
 */
export function isAskingForHelp(content: string): boolean {
  const lowerContent = content.toLowerCase();
  return CONSTANTS.HELP_KEYWORDS.some((keyword) =>
    lowerContent.includes(keyword),
  );
}

/**
 * æ£€æŸ¥æ˜¯å¦åŒ…å«ä»»åŠ¡å®Œæˆæ ‡è®°
 */
export function hasCompletionToken(content: string): boolean {
  return content
    .toLowerCase()
    .includes(CONSTANTS.COMPLETION_TOKEN.toLowerCase());
}

/**
 * è®¡ç®—å­—ç¬¦ä¸²ç›¸ä¼¼åº¦ï¼ˆç”¨äºæ£€æµ‹é‡å¤å†…å®¹ï¼‰
 */
export function isContentSimilar(content1: string, content2: string): boolean {
  const c1 = content1.substring(0, 100).trim().toLowerCase();
  const c2 = content2.substring(0, 100).trim().toLowerCase();
  return c1 === c2 || c1.includes(c2) || c2.includes(c1);
}
